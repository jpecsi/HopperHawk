<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Dashboard - Sideline Data</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
</head>

<body id="page-top" onload="pageSetup()">
    <div id="wrapper">
        <nav class="navbar align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0 navbar-dark">
            <div class="container-fluid d-flex flex-column p-0"><a class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="#">
                    <div class="sidebar-brand-icon rotate-n-15"><i class="fas fa-fire"></i></div>
                    <div class="sidebar-brand-text mx-3"><span>HopperHawk<sup>BETA</sup></span></div>
                </a>
                <hr class="sidebar-divider my-0">
                <ul class="navbar-nav text-light" id="accordionSidebar">
                    <li class="nav-item"><a class="nav-link active" href="index.html"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="readme.html"><i class="fas fa-cog text-white"></i><span>Readme</span></a></li>
                    <li class="nav-item"></li>
                </ul>
                <div class="text-center d-none d-md-inline"><button class="btn rounded-circle border-0" id="sidebarToggle" type="button"></button></div>
            </div>
        </nav>
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <nav class="navbar navbar-expand bg-white shadow mb-4 topbar static-top navbar-light">
                    <div class="container-fluid"><button class="btn btn-link d-md-none rounded-circle me-3" id="sidebarToggleTop" type="button"><i class="fas fa-bars"></i></button><span id="indicator" class="badge bg-danger">Device Not Connected</span></div>
                </nav>
                <div class="container-fluid">
                    <div class="d-sm-flex justify-content-between align-items-center mb-4">
                        <h3 class="text-dark mb-0">HopperHawk Configuration Tool</h3>
                    </div>
                    <div class="col" style="margin-bottom: 19px;">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Device<span class="badge rounded-pill bg-danger" style="margin-left: 60px;margin-bottom: 4px;padding-top: 10px;"></span></h5>
                            </div>
                            <div class="card-body">
                                <div id="deviceStatusAlert" class="alert alert-primary" role="alert">
                                    
                                  </div>
                                <p></p>
                                <form><input id="ipAddr" class="form-control" type="text" placeholder="IP Address or Hostname"></form><button id="connBtn" onclick="connect()" class="btn btn-primary" type="button" style="margin-top: 11px;">Connect/Sync</button><button class="btn btn-warning" type="button" onclick="sysControl(0)" id="rebootBtn" style="margin-top: 11px;margin-left: 15px;">Reboot</button><button id="resetBtn" class="btn btn-danger" onclick="sysControl(1)" type="button" style="margin-left: 15px;margin-top: 11px;">Factory Reset</button>
                                <p class="card-text"></p>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 col-xl-3 mb-4">
                            <div class="card shadow border-start-primary py-2">
                                <div class="card-body">
                                    <div class="row align-items-center no-gutters">
                                        <div class="col me-2">
                                            <div class="text-uppercase text-primary fw-bold text-xs mb-1"><span>Pellet Type</span></div>
                                            <div class="text-dark fw-bold h5 mb-0" id="pType"><span>None</span></div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-tree fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-xl-3 mb-4">
                            <div class="card shadow border-start-info py-2">
                                <div class="card-body">
                                    <div class="row align-items-center no-gutters">
                                        <div class="col me-2">
                                            <div class="text-uppercase text-info fw-bold text-xs mb-1"><span>Pellet Level</span></div>
                                            <div class="row g-0 align-items-center">
                                                <div class="col-auto">
                                                    <div class="text-dark fw-bold h5 mb-0 me-3" id="pLevel"><span>0%</span></div>
                                                </div>
                                                <div class="col">
                                                    <div class="progress progress-sm">
                                                        <div id="pLevelBar" class="progress-bar bg-info" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"><span class="visually-hidden">50%</span></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-auto"><svg xmlns="http://www.w3.org/2000/svg" viewBox="-32 0 512 512" width="1em" height="1em" fill="currentColor" class="fa-2x text-gray-300">
                                                <!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. -->
                                                <path d="M50.7 58.5L0 160H208V32H93.7C75.5 32 58.9 42.3 50.7 58.5zM240 160H448L397.3 58.5C389.1 42.3 372.5 32 354.3 32H240V160zm208 32H0V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V192z"></path>
                                            </svg></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-xl-3 mb-4">
                            <div class="card shadow border-start-info py-2">
                                <div class="card-body">
                                    <div class="row align-items-center no-gutters">
                                        <div class="col me-2">
                                            <div class="text-uppercase text-info fw-bold text-xs mb-1"><span>Battery Level</span></div>
                                            <div class="row g-0 align-items-center">
                                                <div class="col-auto">
                                                    <div class="text-dark fw-bold h5 mb-0 me-3" id="bLevel"><span>0%</span></div>
                                                </div>
                                                <div class="col">
                                                    <div class="progress progress-sm">
                                                        <div id="bLevelBar" class="progress-bar bg-info" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"><span class="visually-hidden">50%</span></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-battery-half fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-xl-3 mb-4">
                            <div class="card shadow border-start-warning py-2">
                                <div class="card-body">
                                    <div class="row align-items-center no-gutters">
                                        <div class="col me-2">
                                            <div class="text-uppercase text-warning fw-bold text-xs mb-1"><span>Battery Status</span></div>
                                            <div class="text-dark fw-bold h5 mb-0" id="bStat"><span>None</span></div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-power-off fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                            <div class="row">
                                <div class="col-xxl-12">
                                    <div class="card shadow mb-3">
                                        <div class="card-header py-3">
                                            <p class="text-primary m-0 fw-bold">Wi-Fi Settings</p>
                                        </div>
                                        <div class="card-body">
                                            <div id="wifiSettingsAlert" class="alert alert-secondary" role="alert">
                                                
                                              </div>
                                            <form>
                                                <div class="row">
                                                    <div class="col">
                                                        <div class="mb-3"><label class="form-label"><strong>Enabled?</strong></label><select id="wifiEnabled" class="form-select">
                                                                <optgroup label="Enable Wi-Fi?">
                                                                    <option value="1" selected="">Yes</option>
                                                                    <option value="0">No</option>
                                                                </optgroup>
                                                            </select></div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col"><label class="form-label"><strong>Connection Details</strong></label><input class="form-control" type="text" id="wifiSSID" placeholder="SSID" style="margin-top: 10px;"><input class="form-control" type="password" id="wifiPassword" placeholder="Password" style="margin-bottom: 19px;margin-top: 11px;"></div>
                                                </div>
                                                <div class="mb-3"><button id="loadWiFiBtn" onclick="loadWifiSettings()" class="btn btn-info btn-sm" type="button" style="margin-top: 18px;">Load Settings</button><button id="saveWiFiBtn" onclick="saveWifiSettings()" class="btn btn-success btn-sm" type="button" style="margin-top: 18px;margin-left: 11px;">Save Settings</button></div>
                                
                                            </form>
                                        </div>
                                    </div>
                                    <div class="card shadow">
                                        <div class="card-header py-3">
                                            <p class="text-primary m-0 fw-bold">MQTT Settings</p>
                                        </div>
                                        <div class="card-body" style="margin-bottom: 22px;">
                                            <div id="mqttSettingsAlert" class="alert alert-secondary" role="alert">
                                                
                                              </div>
                                            <form>
                                                <div class="mb-3"><label class="form-label"><strong>Enabled?</strong></label><select id="mqttEnabled" class="form-select">
                                                        <optgroup label="Enable Wi-Fi?">
                                                            <option value="1" selected="">Yes</option>
                                                            <option value="0">No</option>
                                                        </optgroup>
                                                    </select></div>
                                                <div class="row">
                                                    <div class="col">
                                                        <div class="mb-3"><label class="form-label"><strong>Broker IP</strong></label><input class="form-control" type="text" id="mqttIP" placeholder="192.168.10.30"></div>
                                                    </div>
                                                    <div class="col">
                                                        <div class="mb-3"><label class="form-label"><strong>Broker Port</strong></label><input class="form-control" type="text" id="mqttPort" placeholder="1883"></div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col">
                                                        <div class="mb-3"><label class="form-label"><strong>Username</strong></label><input class="form-control" type="text" id="mqttUser" placeholder="svc-mqtt" name="city"></div>
                                                    </div>
                                                    <div class="col">
                                                        <div class="mb-3"><label class="form-label"><strong>Password</strong></label><input class="form-control" type="password" id="mqttPassword" placeholder="Password" name="country"></div>
                                                    </div>
                                                </div>
                                                <div class="mb-3"><button id="loadMQTTBtn" onclick="loadMQTTSettings()" class="btn btn-info btn-sm" type="button" style="margin-top: 18px;">Load Settings</button><button id="saveMQTTBtn" onclick="saveMQTTSettings()" class="btn btn-success btn-sm" type="button" style="margin-top: 18px;margin-left: 11px;">Save Settings</button></div>
                                
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xxl-12">
                                    <div class="card shadow mb-3"></div>
                                    <div class="card shadow">
                                        <div class="card-header py-3">
                                            <p class="text-primary m-0 fw-bold">Device Settings</p>
                                        </div>
                                        <div class="card-body">
                                            <div id="deviceSettingsAlert" class="alert alert-secondary" role="alert">
                                                
                                              </div>
                                            <form>
                                                <div class="row">
                                                    <div class="col">
                                                        <div class="mb-3"><label class="form-label"><strong>Current Pellets</strong></label><select id="currentPellets" class="form-select">
                                                                <optgroup label="Pellet Type">
                                                                    <option value="Hickory" selected="">Hickory</option>
                                                                    <option value="Mesquite">Mesquite</option>
                                                                    <option value="Oak">Oak</option>
                                                                    <option value="Cherry">Cherry</option>
                                                                    <option value="Apple">Apple</option>
                                                                    <option value="Competition">Competition Blend</option>
                                                                    <option value="Fruitwood">Fruitwood Blend</option>
                                                                    <option value="Other">Other</option>
                                                                </optgroup>
                                                            </select></div>
                                                    </div>
                                                    <div class="col">
                                                        <div class="mb-3"><label class="form-label"><strong>Measurement Frequency</strong></label><select id="measureFrequency" class="form-select">
                                                                <optgroup label="How Often to Measure?">
                                                                    <option value="1" selected="">1 Second</option>
                                                                    <option value="5">5 Seconds</option>
                                                                    <option value="30">30 Seconds</option>
                                                                    <option value="60">1 Minute</option>
                                                                    <option value="300">5 Minutes</option>
                                                                    <option value="600">10 Minutes</option>
                                                                    <option value="1200">20 Minutes</option>
                                                                    <option value="1800">30 Minutes</option>
                                                                    <option value="3600">1 Hour</option>
                                                                </optgroup>
                                                            </select></div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col">
                                                        
                                                        <div class="mb-3"><label class="form-label" style="margin-bottom: 0px;"><strong>Calibration (Empty)&nbsp;</strong></label>
                                                            <p id="emptyCalMeasurement"></p>
                                                        </div><button id="calEmptyBtn" onclick="calibrationPOST(0)" class="btn btn-primary btn-sm" type="button" style="margin-bottom: 44px;">Take Measurement</button>
                                                        
                                                    </div>
                                                    <div class="col">
                                                        <div class="mb-3"><label class="form-label" style="margin-bottom: -1px;"><strong>Calibration (Full)&nbsp;</strong></label>
                                                            <p id="fullCalMeasurement"> </p>
                                                        </div><button id="calFullBtn" onclick="calibrationPOST(1)" class="btn btn-primary btn-sm" type="button">Take Measurement</button>
                                                    </div>
                                                </div>
                                                <div class="mb-3"><button id="loadDeviceBtn" onclick="loadDeviceSettings()" class="btn btn-info btn-sm" type="button" style="margin-top: 18px;">Load Settings</button><button id="saveDeviceBtn" onclick="saveDeviceSettings()" class="btn btn-success btn-sm" type="button" style="margin-top: 18px;margin-left: 11px;">Save Settings</button></div>
                                
                                            </form>
                                            <div class="btn-group" role="group"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    <div class="row"></div>
                </div>
            </div>
            <footer class="bg-white sticky-footer">
                <div class="container my-auto">
                    <div class="text-center my-auto copyright"><span>Copyright © Sideline Data 2024</span></div>
                </div>
            </footer>
        </div><a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a>
    </div>
    <div class="container-fluid"></div>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/theme.js"></script>


    <!-- HopperHawk Scripts -->

    <script>
        var isConnected = false;

        function enableButtons(e){
            if (e == false){
                // Disable the buttons
                document.getElementById("rebootBtn").disabled = true;
                document.getElementById("resetBtn").disabled = true;
                document.getElementById("loadWiFiBtn").disabled = true;
                document.getElementById("saveWiFiBtn").disabled = true;
                document.getElementById("loadMQTTBtn").disabled = true;
                document.getElementById("saveMQTTBtn").disabled = true;
                document.getElementById("loadDeviceBtn").disabled = true;
                document.getElementById("saveDeviceBtn").disabled = true;
                document.getElementById("calFullBtn").disabled = true;
                document.getElementById("calEmptyBtn").disabled = true;
            } else if (e == true){
                // Enable the buttons
                document.getElementById("rebootBtn").disabled = false;
                document.getElementById("resetBtn").disabled = false;
                document.getElementById("loadWiFiBtn").disabled = false;
                document.getElementById("saveWiFiBtn").disabled = false;
                document.getElementById("loadMQTTBtn").disabled = false;
                document.getElementById("saveMQTTBtn").disabled = false;
                document.getElementById("loadDeviceBtn").disabled = false;
                document.getElementById("saveDeviceBtn").disabled = false;
                document.getElementById("calFullBtn").disabled = false;
                document.getElementById("calEmptyBtn").disabled = false;
                document.getElementById("connBtn").disabled = false;
            }
        }

        
        function pageSetup(){
            // Hide the alert message/banner
            document.getElementById("deviceStatusAlert").hidden = 'true';
            document.getElementById("wifiSettingsAlert").hidden = 'true';
            document.getElementById("mqttSettingsAlert").hidden = 'true';
            document.getElementById("deviceSettingsAlert").hidden = 'true';
            enableButtons(false);
        }

        // Device Connectivity
        function connect(){
            var statusIndicator = document.getElementById("deviceStatusAlert");
            var connIP = document.getElementById('ipAddr').value;

            // Check to make sure user provided connection info
            statusIndicator.classList.remove("alert-danger");
            statusIndicator.classList.add("alert-primary");

            if (connIP.length < 1){
                statusIndicator.removeAttribute('hidden');
                statusIndicator.innerHTML = "Please enter an IP address or hostname for HopperHawk"
            } else {
                document.getElementById("connBtn").disabled = true;
                statusIndicator.removeAttribute('hidden');
                if (isConnected == false) {
                    statusIndicator.innerHTML = "Attempting to connect...";
                } else {
                    statusIndicator.innerHTML = "Refreshing data...";
                }
           
                // Save device connection info to reference in config page
                fetch("http://" + document.getElementById('ipAddr').value + "/status").then((response) => {
                    return response.json()
                }).then((data) => {
                
                    if (data["alive"] == true){

                        // Hide the alert
                        document.getElementById("deviceStatusAlert").hidden = 'true';

                        // Update status indicators
                        document.getElementById("indicator").className = "badge bg-success";
                        document.getElementById("indicator").textContent = "Device Connected";
                        document.getElementById("pType").textContent=data["pellet_type"];
                        document.getElementById("pLevel").textContent=data["pellet_level"];
                        document.getElementById("bStat").textContent=data["battery_state"];
                        document.getElementById("bLevel").textContent=data["battery_level"];
                        document.getElementById("pLevelBar").style=("width: " + data["pellet_level"]);
                        document.getElementById("bLevelBar").style=("width: " + data["battery_level"]);

                        if (isConnected == false) {
                            // Load Settings
                            loadDeviceSettings();
                            loadWifiSettings();
                            loadMQTTSettings();
                            isConnected = true;
                        }
                        
                        // Enable connection button
                        document.getElementById("connBtn").disabled = false;
                    } 


                }).catch((error) => {
                    statusIndicator.classList.remove("alert-primary");
                    statusIndicator.classList.add("alert-danger");
                    statusIndicator.innerHTML = "Error Connecting! <br> " + error;
                    // Disable the buttons (except for connect)
                    enableButtons(false);
                    document.getElementById("connBtn").disabled = false;

                });
           
            }
        }

        function loadWifiSettings(){
           // Disable the buttons
           enableButtons(false);

            // GET request to HopperHawk for WiFi settings...
            fetch("http://" + document.getElementById('ipAddr').value + "/configure/wifi").then((response) => {
                return response.json()
            }).then((data) => {
                document.getElementById("wifiSSID").value=data["ssid"];
                document.getElementById("wifiEnabled").value=data["status"];
                document.getElementById("wifiPassword").value="";

                // Enable the buttons
                enableButtons(true);
            })

         
        }

        function saveWifiSettings(){
            // Disable the buttons
            enableButtons(false);

            // Hide the alert/banner
            document.getElementById('wifiSettingsAlert').hidden = 'true';

            // POST request to HopperHawk for WiFi Settings
            fetch("http://" + document.getElementById('ipAddr').value + "/configure/wifi", {
            method: "POST",
            body: JSON.stringify({
                status: document.getElementById("wifiEnabled").value,
                password: document.getElementById("wifiPassword").value,
                ssid: document.getElementById("wifiSSID").value,

            }),
            headers: {
                "Content-type": "application/json; charset=UTF-8"
            }
            })
            .then((response) => {
                response.json();
                // Update the alert
                document.getElementById('wifiSettingsAlert').removeAttribute('hidden');
                document.getElementById('wifiSettingsAlert').innerHTML = "Configuration updated!";

                // Enable the buttons
                enableButtons(true);
                setTimeout(function() {
                    document.getElementById('wifiSettingsAlert').hidden = 'true';
                }, 8000);
            })
            .catch((error) => {
                    document.getElementById('wifiSettingsAlert').removeAttribute('hidden');
                    document.getElementById('wifiSettingsAlert').innerHTML = "Error Connecting! <br> " + error;
                    // Enable the buttons
                    enableButtons(true);
                });
            
            
        }


        function loadMQTTSettings(){
            // Disable the buttons
            enableButtons(false);

            // GET request to HopperHawk for MQTT settings
            fetch("http://" + document.getElementById('ipAddr').value + "/configure/mqtt").then((response) => {
                return response.json()
            }).then((data) => {
                document.getElementById("mqttEnabled").value=data["status"];
                document.getElementById("mqttIP").value=data["broker_ip"]
                document.getElementById("mqttPort").value=data["broker_port"];
                document.getElementById("mqttUser").value=data["user"];
                document.getElementById("mqttPassword").value="";
                // Enable the buttons
                enableButtons(true);
            })


        }

        function saveMQTTSettings(){
        
            // Data validation
            if (isNaN(document.getElementById("mqttPort").value)){
                // If port is not an integer, show an alert....
                document.getElementById('mqttSettingsAlert').removeAttribute('hidden');
                document.getElementById('mqttSettingsAlert').innerHTML = "Port must be a whole number (1 - 65535)"
            } else {
                // Hide the alert/banner
                document.getElementById('mqttSettingsAlert').hidden = "true";
                document.getElementById('mqttSettingsAlert').innerHTML = "";

                // Disable the buttons
                enableButtons(false);

                // POST request to HopperHawk to save MQTT settings
                fetch("http://" + document.getElementById('ipAddr').value + "/configure/mqtt", {
                method: "POST",
                body: JSON.stringify({
                    status: document.getElementById("mqttEnabled").value,
                    password: document.getElementById("mqttPassword").value,
                    client_id: "hopperhawk",
                    broker_ip: document.getElementById("mqttIP").value,
                    broker_port: document.getElementById("mqttPort").value,
                    user: document.getElementById("mqttUser").value
                }),
                headers: {
                    "Content-type": "application/json; charset=UTF-8"
                }
                })
                .then((response) => {
                    response.json();
                    // Update the alert
                    document.getElementById('mqttSettingsAlert').removeAttribute('hidden');
                    document.getElementById('mqttSettingsAlert').innerHTML = "Configuration updated!";

                    // Enable the buttons
                    enableButtons(true);

                    setTimeout(function() {
                        document.getElementById('mqttSettingsAlert').hidden = 'true';
                    }, 8000);
                })
                .catch((error) => {
                    document.getElementById('mqttSettingsAlert').removeAttribute('hidden');
                    document.getElementById('mqttSettingsAlert').innerHTML = "Error Connecting! <br> " + error;
                    // Enable the buttons
                    enableButtons(true);
                });


            }

        }

        function loadDeviceSettings(){
            // Disable the buttons
            enableButtons(false);

            // GET request to HopperHawk for device settings
           fetch("http://" + document.getElementById('ipAddr').value + "/configure/hopper").then((response) => {
                return response.json()
            }).then((data) => {
                document.getElementById("fullCalMeasurement").textContent=("Current Value: " + data["full_measurement"]);
                document.getElementById("emptyCalMeasurement").textContent=("Current Value: " + data["empty_measurement"]);
                document.getElementById("currentPellets").value=data["current_pellets"];
                document.getElementById("measureFrequency").value=data["poll_frequency"];
                // Enable the buttons
                enableButtons(true);
            })
        }
        function saveDeviceSettings(){
            // Hide the alert/banner and update the pellet type display card
            document.getElementById('deviceSettingsAlert').hidden = 'true';
            document.getElementById("pType").textContent = document.getElementById("currentPellets").value;

            // Disable the buttons
            enableButtons(false);

            // POST request to HopperHawk to save device settings
            fetch("http://" + document.getElementById('ipAddr').value + "/configure/hopper", {
            method: "POST",
            body: JSON.stringify({
                current_pellets: document.getElementById("currentPellets").value,
                poll_frequency:  document.getElementById("measureFrequency").value,
            }),
            headers: {
                "Content-type": "application/json; charset=UTF-8"
            }
            })
            .then((response) => {
                response.json();
                document.getElementById('deviceSettingsAlert').removeAttribute('hidden');
                document.getElementById('deviceSettingsAlert').innerHTML = "Configuration updated!";
                // Enable the buttons
                enableButtons(true)

                setTimeout(function() {
                    document.getElementById('deviceSettingsAlert').hidden = 'true';
                }, 8000);

            })
            .catch((error) => {
                    document.getElementById('deviceSettingsAlert').removeAttribute('hidden');
                    document.getElementById('deviceSettingsAlert').innerHTML = "Error Connecting! <br> " + error;
                    document.getElementById("pType").textContent = "Error Updating";
                    // Enable the buttons
                    enableButtons(true)
                });

          
        }

        function sysControl(m){
            // Create a new XMLHttpRequest object
            const xhr = new XMLHttpRequest();

            // 0 = Reboot the Device
            if (m == 0){
                if (confirm('Are you sure you want to reboot the device?')) {
                    // Disable buttons (except connect)
                    enableButtons(false);
                    document.getElementById("connBtn").disabled = false;

                    // POST to reboot
                    xhr.open("POST", "http://" + document.getElementById('ipAddr').value + "/system/reboot", true);
                }
            
            // 1 = Factory Reset the Device
            } else if (m == 1) {
                if (confirm('WARNING: This will clear all settings from the device and perform a factory reset. Are you sure you want to do this?')) {
                    // Disable buttons (except connect)
                    enableButtons(false);
                    document.getElementById("connBtn").disabled = false;

                    // POST to reset
                    xhr.open("POST", "http://" + document.getElementById('ipAddr').value + "/system/factory_reset", true);
                }
            }

            // Configure and send the request
            xhr.setRequestHeader("Content-Type", "application/json");       
            xhr.send();

            // Event handler for success
            xhr.onload = function () {
                if (xhr.status === 200) {
                    // Pass
                } else {
                    console.error("Error:", xhr.statusText);
                }
            };

            // Event handler for error
            xhr.onerror = function () {
                console.error("Request failed:", xhr.statusText);
            };
        }


        function calibrationPOST(m){
            // Create a new XMLHttpRequest object
            const xhr = new XMLHttpRequest();

            // 1 == Full Measurement
            if (m == 1){
                document.getElementById("calFullBtn").disabled = true;
                document.getElementById("calFullBtn").innerHTML = "Measuring...";
                xhr.open("POST", "http://" + document.getElementById('ipAddr').value + "/calibrate/full", true);
            
            // 0 == Empty Measurement
            } else if (m == 0){
                document.getElementById("calEmptyBtn").disabled = true;
                document.getElementById("calEmptyBtn").innerHTML = "Measuring...";
                xhr.open("POST", "http://" + document.getElementById('ipAddr').value + "/calibrate/empty", true);
            }
            
            xhr.setRequestHeader("Content-Type", "application/json");

            // Send the request
            xhr.send();

            // Event handler for success
            xhr.onload = function () {
            if (xhr.status === 200) {
                if (m == 1) {
                    document.getElementById("calFullBtn").disabled = false;
                    document.getElementById("calFullBtn").innerHTML = "Take Measurement";
                    document.getElementById("fullCalMeasurement").textContent=("Current Value: " + JSON.parse(xhr.responseText));
                } else {
                    document.getElementById("calEmptyBtn").disabled = false;
                    document.getElementById("calEmptyBtn").innerHTML = "Take Measurement";
                    document.getElementById("emptyCalMeasurement").textContent=("Current Value: " + JSON.parse(xhr.responseText));
                }
            } else {
                console.error("Error:", xhr.statusText);
                if (m == 1) {
                    document.getElementById("fullCalMeasurement").textContent=("Error");
                    document.getElementById("calFullBtn").disabled = false;
                    document.getElementById("calFullBtn").innerHTML = "Take Measurement";
                } else {
                    document.getElementById("emptyCalMeasurement").textContent=("Error");
                    document.getElementById("calEmptyBtn").disabled = false;
                    document.getElementById("calEmptyBtn").innerHTML = "Take Measurement";
                }
            }
            };

            // Event handler for error
            xhr.onerror = function () {
                console.error("Request failed:", xhr.statusText);
                if (m == 1){
                    document.getElementById("fullCalMeasurement").textContent=("Error");
                    document.getElementById("calFullBtn").disabled = false;
                    document.getElementById("calFullBtn").innerHTML = "Take Measurement";
                } else {
                    document.getElementById("emptyCalMeasurement").textContent=("Error");
                    document.getElementById("calEmptyBtn").disabled = false;
                    document.getElementById("calEmptyBtn").innerHTML = "Take Measurement";
                }
            };


        }

    </script>

    <!------------------------>


</body>

</html>



